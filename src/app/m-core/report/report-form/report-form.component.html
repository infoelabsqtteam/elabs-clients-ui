<section class="report-form">
    <div class="container-fluid">
        <div class="row py-3">
            <div class="col-lg-10" [ngClass]="{'col-lg-12': !queryActionExpand,'col-lg-10':queryActionExpand}" [formGroup]="reportForm">
                <div class="row reportview pt-4 m-0 mb-1 ">
                    <div class="col px-1">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Collection Name</mat-label>
                            <mat-select (selectionChange)="setValue({'field_name':'collection_name'})"
                                [formControlName]="'collection_name'">
                                <mat-option></mat-option>
                                <mat-option *ngFor="let data of staticData['collection_name']; let i = index" [value]="data"
                                    [innerHtml]="getddnDisplayVal(data)">
                                </mat-option>
                            </mat-select>
                            <input type="hidden" [formControlName]="'collectionName'">
                        </mat-form-field>
                    </div>
                    <div class="col px-1">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Name</mat-label>
                            <mat-select (selectionChange)="setValue({'field_name':'name'})" [formControlName]="'name'">
                                <mat-option></mat-option>
                                <mat-option *ngFor="let field of fields; let i = index" [value]="field"
                                    [innerHtml]="getddnDisplayVal(field.label)">
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col px-1">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>Operator</mat-label>
                            <mat-select [formControlName]="'operator'" disableOptionCentering panelClass="optiondropdown">
                                <mat-option></mat-option>
                                <mat-option *ngFor="let staticValue of operaters | keyvalue" [value]="staticValue.key"
                                    [innerHtml]="getddnDisplayVal(staticValue.value)"></mat-option>
                            </mat-select>
                        </mat-form-field>   
                    </div>             
                    
                    <div *ngIf="field.type == 'date' || field.type == 'daterange'">
                        <div class="col px-1">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Value</mat-label>
                                <input matInput [matDatepicker]="picker2" [formControlName]="'value'" autocomplete="off">
                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                <mat-datepicker #picker2 color="primary"></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="field.type == 'text' || field.type == 'textarea' || field.type == 'email' || field.type == 'gst_number' || field.type == 'typeahead' || field.type == 'po_number' || field.type == 'radio' || field.type == 'tree_view_selection'">
                        <div class="col px-1">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Value</mat-label>
                                <input matInput type="text" [formControlName]="'value'" autocomplete="off">
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="field.type == 'number'">
                        <div class="col px-1">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Value</mat-label>
                                <input matInput type="number" [formControlName]="'value'" autocomplete="off">
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="field.type == 'dropdown'">
                        <div class="col px-1">
                            <mat-form-field appearance="outline" class="w-100" *ngIf="field.datatype != 'object' && field.datatype != 'key_value'">
                                <mat-label>Value</mat-label>
                                <mat-select [formControlName]="'value'">
                                    <mat-option></mat-option>
                                    <mat-option *ngFor="let field of staticData[field.ddn_field]; let i = index"
                                        [value]="field" [innerHtml]="getddnDisplayVal(field)">
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-form-field appearance="outline" class="w-100" *ngIf="field.datatype == 'key_value'">
                                <mat-label>Value</mat-label>
                                <mat-select [formControlName]="'value'">
                                    <mat-option></mat-option>
                                    <mat-option *ngFor="let staticValue of staticData[field.ddn_field]| keyvalue"
                                        [value]="staticValue.key" [innerHtml]="getddnDisplayVal(staticValue.value)">
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-form-field appearance="outline" class="w-100" *ngIf="field.datatype == 'object'">
                                <mat-label>Value</mat-label>
                                <mat-select [compareWith]="compareObjects" [formControlName]="'value'">
                                    <mat-option></mat-option>
                                    <mat-option *ngFor="let staticValue of staticData[field.ddn_field]"
                                        [value]="staticValue" [innerHtml]="getddnDisplayVal(staticValue)">
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    <div *ngIf="field.type == 'checkbox'">
                        <div class="col px-1">
                            <mat-checkbox color="primary" class="example-margin" [formControlName]="'value'" >{{ field.label }}</mat-checkbox>
                        </div>
                    </div>  
                    <div *ngIf="field.type == 'time'">
                        <div class="col px-1">
                            <mat-form-field appearance="outline" class="example-full-width w-100">
                                <mat-label>Value</mat-label>
                                <input matInput [ngxTimepicker]="picker"  [formControlName]="'value'"
                                    readonly  [format]="getTimeFormat(field)">
                                <ngx-material-timepicker #picker></ngx-material-timepicker>
                            </mat-form-field>
                        </div>
                    </div> 
                    <div class="col px-1">
                        <button mat-icon-button class="mr-1" (click)="clear()"><span class="material-icons-outlined">clear</span></button>
                        <button mat-mini-fab class="mr-1" [style.background-color]="!checkValidator()?btnColour:''" [style.color]="btnTxtColour" [disabled]="checkValidator()" (click)="addCrlist()"><span class="material-icons-outlined">add</span></button>
                        <button mat-icon-button class="mr-1" (click)="toggleQuery()"><span *ngIf="!queryExpand" class="material-icons-outlined">expand_more</span><span *ngIf="queryExpand" class="material-icons-outlined">expand_less</span></button>
                        <button mat-icon-button (click)="toggleQueryAction()"><span *ngIf="queryActionExpand" class="material-icons-outlined">chevron_right</span><span *ngIf="!queryActionExpand" class="material-icons-outlined">chevron_left</span>
                        </button>
                    </div>
                </div>
                <mat-accordion class="example-headers-align">
                    <mat-expansion-panel [expanded]="queryExpand"> 
                        <div class="row m-0">
                            <div class="reportview col-lg-12">
                                <div class="row m-0">
                                    <div class="chipsdata col-lg-11">
                                        <span class="chips" *ngFor="let chips of crList; let i = index">
                                            <span [innerHtml]="getChipsValue(chips)"></span>
                                            <!-- <mat-icon class="edit" (click)="editchips(i)">edit</mat-icon> -->
                                            <mat-icon class="del" (click)="dropchips(i)">cancel</mat-icon>
                                        </span>
                                    </div>
                                    <div class="col-lg-1">
                                        <div>
                                            <button mat-raised-button class="mb-2" [disabled]="submitValidator()"
                                            (click)="resetConfirm()">Reset</button>
                                        </div>
                                        <div>
                                            <button mat-raised-button [style.background-color]="btnColour" [style.color]="btnTxtColour"  [disabled]="submitValidator()"
                                            (click)="submitdata()">Submit</button>
                                        </div>                                
                                    </div>
                                </div>
                            </div>
                        </div>
                    </mat-expansion-panel>                  
                </mat-accordion>
            </div>
            <div class="reportview" [ngClass]="{'d-none': !queryActionExpand,'col-lg-2':queryActionExpand}">
                <mat-accordion class="example-headers-align">
                    <mat-expansion-panel [expanded]="queryActionExpand"> 
                        <div class="">
                            <button mat-button class="w-100 reportbtn mb-3" [disabled]="submitValidator()"
                                (click)="savemodal()">
                                {{updatemode ? "Upadte Query" : "Save Query"}} </button>
                            <button mat-button class="w-100 reportbtn mb-3" (click)="loadquerymodal()">Load Query</button>
                            <button mat-button class="w-100 reportbtn mb-3" [disabled]="!(gridData.length > 0)"
                                (click)="exportExcel()">Download Excel</button>
                            <!-- <button mat-button class="w-100 reportbtn">Schedule</button> -->
                        </div>
                    </mat-expansion-panel>                  
                </mat-accordion>
            </div>
        </div>
        <div class="row py-2">
            <div class="col-lg-12">
                <table class="table table-striped table-bordered" style="font-size:12px;"
                    *ngIf="columns && columns.length > 0 && gridData.length > 0">
                    <thead>
                        <tr>
                            <th scope="col px-1">#</th>
                            <th scope="col px-1" *ngFor="let data of columns;">{{data.label}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let data of gridData; let j = index">
                            <th scope="row">{{j + 1}}</th>
                            <td *ngFor="let elId of columns; let j = index">
                                <div class="grid-data">
                                    <span [innerHtml]="getValueForGrid(elId,data)"
                                        [matTooltip]="getValueForGridTooltip(elId,data)"
                                        [matTooltipPosition]="'above'"></span>
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="gridData.length == 0">
                            <td class="text-center">
                                <div class="py-3 font-weight-bold">No Records Found !!!</div>
                            </td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</section>
<app-confirm-modal id="confirm-modal" (alertResponce)="alertResponce($event)"></app-confirm-modal>
<app-report-save-query id="savequery-modal" [saveQurydata]="mySaveQueryData" [mode]="updatemode" [fields]="fields"
    (saveQueryResponce)="saveQueryResponce($event)"></app-report-save-query>
<app-report-load-query id="loadquery-modal" [loadQuerydata]="myLoadQueryData" [fields]="fields"
    (loadQueryResponce)="loadQueryResponce($event)"></app-report-load-query>